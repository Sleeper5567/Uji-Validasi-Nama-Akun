<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validator Akun Akuntansi dengan Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .table-cell-transition { transition: background-color 0.5s ease-in-out; }
        .btn-transition { transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out; }
        .btn-transition:active { transform: scale(0.98); }
        #loader { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4 sm:p-6">

    <div id="loader"></div>

    <div id="app-container" class="w-full max-w-5xl bg-white p-6 sm:p-8 rounded-2xl shadow-lg hidden">
        
        <div class="text-center mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-800">Aplikasi Validator Akun Akuntansi</h1>
            <p class="text-slate-500 mt-2 text-sm sm:text-base">Data Anda tersimpan aman di Cloud dengan Firebase.</p>
        </div>

        <div class="mb-6">
            <label for="company-name" class="block text-sm font-medium text-slate-700 mb-2">Nama Perusahaan yang Diobservasi</label>
            <input type="text" id="company-name" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Contoh: PT Maju Jaya Abadi">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end bg-slate-50 p-4 rounded-lg mb-6 border border-slate-200">
            <div class="col-span-1"><label for="account-select" class="block text-sm font-medium text-slate-700 mb-2">Pilih Nama Akun</label><select id="account-select" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></select></div>
            <div class="col-span-1"><label for="category-select" class="block text-sm font-medium text-slate-700 mb-2">Pilih Kategori Akun</label><select id="category-select" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></select></div>
            <div class="col-span-1"><button id="add-btn" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 btn-transition">Tambah ke Tabel</button></div>
        </div>
        
        <div class="overflow-x-auto rounded-lg border border-slate-200">
            <table class="min-w-full bg-white">
                <thead class="bg-slate-200">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-600 uppercase tracking-wider">Nama Akun</th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-600 uppercase tracking-wider">Kategori Pilihan</th>
                        <th id="result-header" class="px-6 py-3 text-left text-xs font-bold text-slate-600 uppercase tracking-wider hidden">Hasil Validasi</th>
                    </tr>
                </thead>
                <tbody id="result-table-body" class="divide-y divide-slate-200"></tbody>
            </table>
        </div>

        <div id="action-buttons" class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
            <button id="check-btn" class="w-full sm:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 btn-transition disabled:bg-slate-400 disabled:cursor-not-allowed">Periksa Hasil</button>
            <button id="reset-btn" class="w-full sm:w-auto bg-slate-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 btn-transition hidden">Mulai Ulang</button>
        </div>
    </div>

    <script type="module">
        // Import Firebase services
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- KONFIGURASI FIREBASE ---
            // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAL24rfJVQpKqjE357shsDhGCXYRx3OLHA",
  authDomain: "uji-validasi-nama-akun.firebaseapp.com",
  projectId: "uji-validasi-nama-akun",
  storageBucket: "uji-validasi-nama-akun.firebasestorage.app",
  messagingSenderId: "665015681890",
  appId: "1:665015681890:web:774d0f0c38c5dac4b2a23b"
};
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;
        let firestoreDocRef = null;
        let unsubscribe = null;

        // --- DATA MASTER (unchanged) ---
        const accountMappings = {
            'Kas': 'Harta Lancar', 'Piutang Usaha': 'Harta Lancar', 'Persediaan Barang Dagang': 'Harta Lancar', 'Perlengkapan Kantor': 'Harta Lancar', 'Sewa Dibayar di Muka': 'Harta Lancar', 'Asuransi Dibayar di Muka': 'Harta Lancar',
            'Tanah': 'Harta Tetap', 'Gedung': 'Harta Tetap', 'Kendaraan': 'Harta Tetap', 'Peralatan Toko': 'Harta Tetap', 'Akumulasi Penyusutan Gedung': 'Harta Tetap', 'Akumulasi Penyusutan Kendaraan': 'Harta Tetap',
            'Utang Usaha': 'Utang', 'Utang Gaji': 'Utang', 'Utang Bank': 'Utang', 'Pendapatan Diterima di Muka': 'Utang',
            'Modal Pemilik': 'Modal', 'Prive Pemilik': 'Modal',
            'Pendapatan Jasa': 'Pendapatan Operasional', 'Pendapatan Penjualan': 'Pendapatan Operasional', 'Pendapatan Bunga': 'Pendapatan Bukan Operasional', 'Pendapatan Sewa': 'Pendapatan Bukan Operasional',
            'Beban Gaji': 'Beban Operasional', 'Beban Sewa Kantor': 'Beban Operasional', 'Beban Listrik dan Air': 'Beban Operasional', 'Beban Iklan': 'Beban Operasional', 'Beban Penyusutan Peralatan': 'Beban Operasional', 'Beban Bunga': 'Beban Bukan Operasional', 'Beban Administrasi Bank': 'Beban Bukan Operasional',
        };
        const categories = ['Harta Lancar', 'Harta Tetap', 'Utang', 'Modal', 'Pendapatan Operasional', 'Pendapatan Bukan Operasional', 'Beban Operasional', 'Beban Bukan Operasional'];

        // --- DOM ELEMENTS ---
        const loader = document.getElementById('loader');
        const appContainer = document.getElementById('app-container');
        const accountSelect = document.getElementById('account-select');
        const categorySelect = document.getElementById('category-select');
        const addBtn = document.getElementById('add-btn');
        const checkBtn = document.getElementById('check-btn');
        const resetBtn = document.getElementById('reset-btn');
        const tableBody = document.getElementById('result-table-body');
        const resultHeader = document.getElementById('result-header');
        const companyNameInput = document.getElementById('company-name');

        async function saveState() {
            if (!firestoreDocRef) return;
            const tableRows = Array.from(tableBody.querySelectorAll('tr:not(#empty-row)'));
            const tableData = tableRows.map(row => ({ account: row.cells[0].textContent, category: row.cells[1].textContent }));
            const state = { companyName: companyNameInput.value, tableData: tableData, isChecked: checkBtn.classList.contains('hidden') };
            try { await setDoc(firestoreDocRef, state); } catch (error) { console.error("Error saving state: ", error); }
        }

        async function resetApp() {
            if (firestoreDocRef) await deleteDoc(firestoreDocRef);
        }

        function renderState(state) {
            companyNameInput.value = state.companyName || '';
            tableBody.innerHTML = '';
            if (state.tableData && state.tableData.length > 0) {
                state.tableData.forEach(item => {
                    const newRow = document.createElement('tr');
                    newRow.classList.add('table-cell-transition');
                    newRow.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">${item.account}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${item.category}</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium result-cell hidden"></td>`;
                    tableBody.appendChild(newRow);
                });
                checkBtn.disabled = false;
            } else {
                tableBody.innerHTML = `<tr id="empty-row"><td colspan="3" class="text-center py-8 text-slate-400">Belum ada data yang ditambahkan.</td></tr>`;
                checkBtn.disabled = true;
            }
            populateAccountSelect();
            populateCategorySelect();
            resultHeader.classList.add('hidden');
            checkBtn.textContent = 'Periksa Hasil';
            addBtn.disabled = false;
            addBtn.classList.remove('bg-slate-400', 'cursor-not-allowed');
            resetBtn.classList.add('hidden');
            checkBtn.classList.remove('hidden');
            if (state.isChecked) checkResults(false);
        }

        function initializeEmptyState() {
             companyNameInput.value = '';
             tableBody.innerHTML = `<tr id="empty-row"><td colspan="3" class="text-center py-8 text-slate-400">Belum ada data yang ditambahkan.</td></tr>`;
             populateAccountSelect();
             populateCategorySelect();
             resultHeader.classList.add('hidden');
             checkBtn.disabled = true;
             checkBtn.textContent = 'Periksa Hasil';
             addBtn.disabled = false;
             addBtn.classList.remove('bg-slate-400', 'cursor-not-allowed');
             resetBtn.classList.add('hidden');
             checkBtn.classList.remove('hidden');
        }

        function getAddedAccounts() {
             const tableRows = Array.from(tableBody.querySelectorAll('tr:not(#empty-row)'));
             return new Set(tableRows.map(row => row.cells[0].textContent));
        }

        function populateAccountSelect() {
            const addedAccounts = getAddedAccounts();
            accountSelect.innerHTML = '<option value="">-- Pilih Akun --</option>';
            const accounts = Object.keys(accountMappings).sort();
            accounts.forEach(account => { if (!addedAccounts.has(account)) { const option = document.createElement('option'); option.value = account; option.textContent = account; accountSelect.appendChild(option); } });
        }

        function populateCategorySelect() {
            categorySelect.innerHTML = '<option value="">-- Pilih Kategori --</option>';
            categories.forEach(category => { const option = document.createElement('option'); option.value = category; option.textContent = category; categorySelect.appendChild(option); });
        }

        async function addClassification() {
            const selectedAccount = accountSelect.value, selectedCategory = categorySelect.value;
            if (!selectedAccount || !selectedCategory) { alert('Silakan pilih nama akun dan kategori.'); return; }
            const emptyRow = document.getElementById('empty-row');
            if (emptyRow) emptyRow.remove();
            const newRow = document.createElement('tr');
            newRow.classList.add('table-cell-transition');
            newRow.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">${selectedAccount}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${selectedCategory}</td><td class="px-6 py-4 whitespace-nowrap text-sm font-medium result-cell hidden"></td>`;
            tableBody.appendChild(newRow);
            populateAccountSelect();
            categorySelect.selectedIndex = 0;
            checkBtn.disabled = false;
            await saveState();
        }

        async function checkResults(shouldSave = true) {
            const rows = tableBody.querySelectorAll('tr:not(#empty-row)');
            if (rows.length === 0) return;
            resultHeader.classList.remove('hidden');
            rows.forEach(row => {
                const accountName = row.cells[0].textContent, userCategory = row.cells[1].textContent, resultCell = row.cells[2];
                resultCell.classList.remove('hidden');
                const correctCategory = accountMappings[accountName];
                row.classList.remove('bg-green-100', 'bg-red-100');
                if (userCategory === correctCategory) { row.classList.add('bg-green-100'); resultCell.innerHTML = `<span class="text-green-700 font-bold">Benar ✔️</span>`; } 
                else { row.classList.add('bg-red-100'); resultCell.innerHTML = `<span class="text-red-700 font-bold">Salah ❌</span> <br><span class="text-xs font-normal text-slate-600">Seharusnya: ${correctCategory}</span>`; }
            });
            addBtn.disabled = true; addBtn.classList.add('bg-slate-400', 'cursor-not-allowed');
            checkBtn.classList.add('hidden'); resetBtn.classList.remove('hidden');
            if (shouldSave) await saveState();
        }

        onAuthStateChanged(auth, user => {
            if (user) {
                userId = user.uid;
                // Path diubah agar lebih sederhana untuk aturan keamanan
                const appId = firebaseConfig.projectId || 'default-app-id';
                firestoreDocRef = doc(db, "artifacts", appId, "users", userId);
                if (unsubscribe) unsubscribe();
                unsubscribe = onSnapshot(firestoreDocRef, (doc) => {
                    loader.classList.add('hidden'); appContainer.classList.remove('hidden');
                    if (doc.exists()) renderState(doc.data());
                    else initializeEmptyState();
                }, (error) => { console.error("Firestore listener error: ", error); loader.classList.add('hidden'); appContainer.classList.remove('hidden'); });
            }
        });

        async function main() {
            try { await signInAnonymously(auth); } 
            catch (error) { console.error("Authentication failed: ", error); loader.innerText = "Gagal mengautentikasi. Muat ulang halaman."; }
        }
        
        addBtn.addEventListener('click', addClassification);
        checkBtn.addEventListener('click', () => checkResults(true));
        resetBtn.addEventListener('click', resetApp);
        companyNameInput.addEventListener('input', saveState);

        main();
    </script>
</body>
                       
   </html>
   
